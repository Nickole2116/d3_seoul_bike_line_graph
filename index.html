<!DOCTYPE html>
<meta charset="utf-8">
<head>
  <title>Seoul Bike Rented Statistic</title>
  <link href="./styles.css" type="text/css">
<style>

.axis .domain {
  display: none;
}

.stop-left 
{
  stop-color: #3f51b5;  /* Indigo */
}

.stop-right 
{
  stop-color: #009688;  /* Teal */
}

.axis-orange line{
  stroke: #3d6470;
}

.axis-orange path{
  stroke: #3d6470;
}

.axis-orange text{
  fill: #3d6470;
}  
.axis-grid line {
  stroke: #345862;
}

</style>
</head>
<body style="width: 100%;margin-left:none;background-color:#173036">
    <div style="width: 100%;background-color:#173036;color:#365b65;"><h1 style="text-align: center;font-family:Arial, Helvetica, sans-serif">Autumn Bike Renting Rates in Seoul</h1></div>
    <div style="text-align: center;">
      <select>
        <option>Monthly Renting Rates</option>
        <option>Last 2 Weeks Renting Rates</option>
      </select>
    </div>
    <div id="total_rented"></div>
    <div id="temperature"></div>
    <div id="pie-function"></div>
<script src="https://d3js.org/d3.v4.min.js"></script>
<script src="https://d3js.org/d3.v4.js"></script>


</body>

<script>

  // set the dimensions and margins of the graph
  var margin = {top: 10, right: 30, bottom: 30, left: 60},
      width = 1000 - margin.left - margin.right,
      full_width = 1000,
      height = 200 - margin.top - margin.bottom,
      full_height = 200;

  // append the svg object to the body of the page
  var svg = d3.select("#total_rented")
            .append("svg")
              .attr("width", full_width)
              .attr("height", full_height)
            .append("g")
              .attr("transform",
                    "translate(" + margin.left + "," + margin.top + ")");

  var formatTime = d3.timeParse("%m/%d/%Y %H:%M:%S");
  //load the dataset and generate it into variables
  d3.csv("datas.csv",
    function(d){
      var fulldate = d.Date + " "+d.Hour+":20:00";
      return { Date : formatTime(fulldate), rented_count : d.rented_count, functioning : d.Functioning, Temperature : d.Temperature }
    },
    function(data){

      console.log(data[1]);
        //---------------------------------------------------------------
        // Rented Rates - line graphs
        //---------------------------------------------------------------
        // Max value observed:
        const max = d3.max(data, function(d) { return +d.rented_count; })

      var x = d3.scaleTime()
        .domain(d3.extent(data, function(d) { return d.Date; }))
        .range([ 0, width ]);

        //tick the gridline of x axis
      svg.append("g")
        .attr('class', 'x axis-grid')
        .attr("transform", "translate(0," + height + ")")
        .call(d3.axisBottom(x).tickSize(-height).tickFormat('').ticks(10));

      // Add x AXIS
      svg.append("g")
        .attr("class", "axis-orange")
        .attr("transform", "translate(0," + height + ")")
        .call(d3.axisBottom(x).ticks(10));

        // Add Y axis
      var y = d3.scaleLinear()
        .domain([0, max])
        .range([ height, 0 ]);

        //tick the gridline of y-axis
      svg.append("g")
        .attr('class', 'y axis-grid')
        .call(d3.axisLeft(y).tickSize(-width).tickFormat('').ticks(10));

      svg.append("g")
        .attr("class", "axis-orange")
        .call(d3.axisLeft(y).ticks(10));

      

        // Set the gradient
      svg.append("linearGradient")
        .attr("id", "line-gradient")
        .attr("gradientUnits", "userSpaceOnUse")
        .attr("x1", 0)
        .attr("y1", 0)
        .attr("x2", "100%")
        .attr("y2", 0)
        .selectAll("stop")
          .data([
            {offset: "0%", color: "#ca5490"},
            {offset: "50%", color: "#f7a344"},
            {offset: "100%", color: "#ef686f"}
          ])
          .enter().append("stop")
            .attr("offset", function(d) { return d.offset; })
            .attr("stop-color", function(d) { return d.color; });

          // Add the line
        svg.append("path")
          .datum(data)
          .attr("fill", "none")
          .attr("stroke", "url(#line-gradient)" )
          .attr("stroke-width", 2)
          .attr("d", d3.line()
            .x(function(d) { return x(d.Date) })
            .y(function(d) { return y(d.rented_count) })
          )
          .on("mouseover", mouseover)
          .on("mouseout", mouseOut)
          .on("mousemove", mousemove);

          var tooltip = d3.select("body").append("div")
            .style("z-index","10").style("visibility","hidden").style("margin-left","20px").style("color","#9badb2").text("a simple tooltips");
            var bisectDate = d3.bisector(function(d){
              return d.Date;
            }).left;

          function mouseover()
          {
            d3.select(this)
            .transition()
            .duration(500)
            .attr('stroke-width',4);

            


            
          }

          function mouseOut()
          {
            d3.select(this)
            .transition()
            .duration(500)
            .attr('stroke-width',2);

            return tooltip.style("visibility","hidden");

            
          }

          function mousemove()
          {
            
            var x0 = x.invert(d3.mouse(this)[0]),
            i = bisectDate(data,x0,1),
            d0 = data[i-1],
            d1 =data[i],
            d = x0 - d0.Date > d1.Date - x0 ? d1 :d0;
            console.log(d.Date);
            console.log(d.rented_count);

            tooltip.text("Rented : "+d.rented_count+"("+d.Date+")");
            return tooltip.style("visibility","visible");

            tooltip.style("top",(d3.event.pageY-10)+"px")
            .style("left",(d3.event.pageX+10)+"px")
            .style("background","red");


            
          }

            

        //-----------------------------------------------------------
        // END line graph 
        //-----------------------------------------------------------

          //var function 
          var all_count_data = data.length;
          var count_functioning_func = 0;
          for(var c=0;c<all_count_data;c++)
          {
            count_functioning_func += parseInt(data[c].functioning);
          }
          var non_func_counts = all_count_data - count_functioning_func;

          console.log(non_func_counts);

        var data_pie = [non_func_counts, count_functioning_func];

          var width_pie = "200";
          var height_pie = "200";
          var svg_pie = d3.select("#pie-function")
                        .append("svg")
                        .attr("height",width_pie+"px")
                        .attr("width",height_pie+"px");
          var radius = Math.min(width_pie,height_pie) / 3;
          var t = svg_pie.append("g").attr("transform","translate("+ width_pie / 2 + ","+ height_pie / 2 +")");

          var color_pie = d3.scaleOrdinal(['#365b65','#f7a642','#365b65']);
        
        // Generate the pie
    var pie = d3.pie();

// Generate the arcs
var arc = d3.arc()
            .innerRadius(0)
            .outerRadius(radius);

            //Generate groups
    var arcs = t.selectAll("arc")
                .data(pie(data_pie))
                .enter()
                .append("g")
                .attr("class", "arc")

    //Draw arc paths
    arcs.append("path")
        .attr("fill", function(d, i) {
            return color_pie(i);
        })
        .attr("d", arc);

/*
End of Pie Chart
*/

/**
Start of Other Line graphs
*/



















        /*var svg2 = d3.selectAll("#pie-function")
            .append("text")
              .attr("width", full_width)
              .attr("height", full_height)
                            .text( data.length);*/

              //.text( data[1].functioning);

              
       
    });

    


</script>